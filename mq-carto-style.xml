<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE Map[]>
<Map srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">

<Parameters>
  <Parameter name="metatile">1</Parameter>
  <Parameter name="center">-75.6038,40.0799,11</Parameter>
  <Parameter name="maxzoom">16</Parameter>
  <Parameter name="minzoom">0</Parameter>
  <Parameter name="name"><![CDATA[MQ Carto Vector]]></Parameter>
</Parameters>


<Layer name="boundingbox"
  buffer-size="2"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="file"><![CDATA[/home/pnorman/mq-carto-style-vector/10m-900913-bounding-box.shp]]></Parameter>
       <Parameter name="type"><![CDATA[shape]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="water"
  buffer-size="2"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom
  FROM mq_water_polygon
  WHERE ST_Area(geom)/NULLIF(!pixel_width!::float*!pixel_height!::float, 0) > 0.25
) AS water]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="landmark_polygon"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom, landmark
  FROM mq_landmark
  WHERE ST_Area(geom)/NULLIF(!pixel_width!::float*!pixel_height!::float, 0) > 0.25 -- This also excludes ST_Points
  ORDER BY zlevel ASC, area DESC
) AS landmark_polygon]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="buildings"
  buffer-size="2"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom
  FROM mq_building
  WHERE z(!scale_denominator!) >= 12
) AS buildings]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="admin_lines"
  buffer-size="8"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT 
    geom, admin
  FROM mq_admin_line
  WHERE z(!scale_denominator!) < 6 AND admin IN ('country','state')
    OR (z(!scale_denominator!) >= 6 AND z(!scale_denominator!) < 12 AND admin IN ('country','state','county','township'))
    OR z(!scale_denominator!) >= 12
  ORDER BY admin DESC
) AS admin_lines]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="trans_linear"
  buffer-size="16"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom, transportation::text, display_class, brunnel, NULL as ramp, NULL as toll
  FROM mq_transportation
  WHERE st_geometrytype(geom) = 'ST_LineString'
    AND ((z(!scale_denominator!) >= 4
        AND z(!scale_denominator!) < 8
        AND transportation = 'road' AND display_class = 0)
      OR (z(!scale_denominator!) >= 8
        AND z(!scale_denominator!) < 10
        AND transportation = 'road' AND display_class BETWEEN 0 AND 2)
      OR (z(!scale_denominator!) >= 10
        AND z(!scale_denominator!) < 12
        AND ((transportation = 'road' AND display_class BETWEEN 0 AND 3)
          OR transportation = 'ferry'))
      OR (z(!scale_denominator!) >= 12
        AND z(!scale_denominator!) < 14
        AND ((transportation = 'road' AND display_class BETWEEN 0 AND 4)
          OR transportation = 'ferry')
          OR transportation = 'rail')
      OR (z(!scale_denominator!) >= 14
        AND z(!scale_denominator!) < 16
        AND transportation IN ('road', 'ferry', 'rail'))
      OR z(!scale_denominator!) >= 16)
  ORDER BY zlevel ASC,
    transportation, -- probably needs a better ordering here
    display_class DESC
) AS trans_linear]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="highway_labels"
  buffer-size="64"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom,
    -- This is a bit of a hack to split them out, because vector tiles can't handle arrays
    -- Also, it ignores shield_priorities as that's very difficult to handle without 9.4
    split_part(tags->'INT-shield', ',', 1) AS shield1,
    split_part(tags->'INT-shield_banner', ',', 1) AS shield1_banner,
    split_part(tags->'INT-shield_number', ',', 1) AS shield1_number,
    length(split_part(tags->'INT-shield_number', ',', 1)) AS shield1_number_length,
    split_part(tags->'INT-shield_prefix', ',', 1) AS shield1_prefix,
    split_part(tags->'INT-shield', ',', 2) AS shield2,
    split_part(tags->'INT-shield_banner', ',', 2) AS shield2_banner,
    split_part(tags->'INT-shield_number', ',', 2) AS shield2_number,
    length(split_part(tags->'INT-shield_number', ',', 2)) AS shield2_number_length,
    split_part(tags->'INT-shield_prefix', ',', 2) AS shield2_prefix,
    split_part(tags->'INT-shield', ',', 3) AS shield3,
    split_part(tags->'INT-shield_banner', ',', 3) AS shield3_banner,
    split_part(tags->'INT-shield_number', ',', 3) AS shield3_number,
    length(split_part(tags->'INT-shield_number', ',', 3)) AS shield3_number_length,
    split_part(tags->'INT-shield_prefix', ',', 3) AS shield3_prefix,
    split_part(tags->'INT-shield', ',', 4) AS shield4,
    split_part(tags->'INT-shield_banner', ',', 4) AS shield4_banner,
    split_part(tags->'INT-shield_number', ',', 4) AS shield4_number,
    length(split_part(tags->'INT-shield_number', ',', 4)) AS shield4_number_length,
    split_part(tags->'INT-shield_prefix', ',', 4) AS shield4_prefix
  FROM mq_transportation
    WHERE shield_count > 0
      AND ((z(!scale_denominator!) >= 4
      AND z(!scale_denominator!) < 8
      AND transportation = 'road' AND display_class = 0)
    OR (z(!scale_denominator!) >= 8
      AND z(!scale_denominator!) < 10
      AND transportation = 'road' AND display_class BETWEEN 0 AND 2)
    OR (z(!scale_denominator!) >= 10
      AND z(!scale_denominator!) < 12
      AND ((transportation = 'road' AND display_class BETWEEN 0 AND 3)
        OR transportation = 'ferry'))
    OR (z(!scale_denominator!) >= 12
      AND z(!scale_denominator!) < 14
      AND ((transportation = 'road' AND display_class BETWEEN 0 AND 4)
        OR transportation = 'ferry')
        OR transportation = 'rail')
    OR (z(!scale_denominator!) >= 14
      AND z(!scale_denominator!) < 16
      AND transportation IN ('road', 'ferry', 'rail'))
    OR z(!scale_denominator!) >= 16)
  ORDER BY display_class DESC
) AS trans_linear]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="place_labels"
  buffer-size="64"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom, label AS name,  admin, display_class
  FROM mq_admin_point
  ORDER BY display_class ASC NULLS LAST,
    population DESC NULLS LAST
) AS place_labels]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="highway_overlay"
  buffer-size="16"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom, display_class
  FROM mq_transportation
  WHERE transportation = 'road'
    AND display_class = 0
) AS highway_overlay]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

<Layer name="trans_linear_labels"
  buffer-size="64"
  srs="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over">
    
    <Datasource>
       <Parameter name="dbname"><![CDATA[]]></Parameter>
       <Parameter name="extent"><![CDATA[-20037508,-20037508,20037508,20037508]]></Parameter>
       <Parameter name="geometry_field"><![CDATA[geom]]></Parameter>
       <Parameter name="geometry_table"><![CDATA[]]></Parameter>
       <Parameter name="host"><![CDATA[]]></Parameter>
       <Parameter name="key_field"><![CDATA[]]></Parameter>
       <Parameter name="max_size"><![CDATA[512]]></Parameter>
       <Parameter name="password"><![CDATA[]]></Parameter>
       <Parameter name="port"><![CDATA[]]></Parameter>
       <Parameter name="table"><![CDATA[(SELECT
    geom, label AS name, transportation, display_class -- also needs toll
  FROM mq_transportation
  WHERE label IS NOT NULL
      AND ((z(!scale_denominator!) >= 4
      AND z(!scale_denominator!) < 8
      AND transportation = 'road' AND display_class = 0)
    OR (z(!scale_denominator!) >= 8
      AND z(!scale_denominator!) < 10
      AND transportation = 'road' AND display_class BETWEEN 0 AND 2)
    OR (z(!scale_denominator!) >= 10
      AND z(!scale_denominator!) < 12
      AND ((transportation = 'road' AND display_class BETWEEN 0 AND 3)
        OR transportation = 'ferry'))
    OR (z(!scale_denominator!) >= 12
      AND z(!scale_denominator!) < 14
      AND ((transportation = 'road' AND display_class BETWEEN 0 AND 4)
        OR transportation = 'ferry')
        OR transportation = 'rail')
    OR (z(!scale_denominator!) >= 14
      AND z(!scale_denominator!) < 16
      AND transportation IN ('road', 'ferry', 'rail'))
    OR z(!scale_denominator!) >= 16)
    ORDER BY zlevel ASC,
    transportation, -- probably needs a better ordering here
    display_class DESC
) AS trans_linear_labels]]></Parameter>
       <Parameter name="type"><![CDATA[postgis]]></Parameter>
       <Parameter name="user"><![CDATA[]]></Parameter>
    </Datasource>
  </Layer>

</Map>